<!DOCTYPE html>
<html lang="en" translate="yes">
    <head>
        <title>tyty studio</title>
        
        <style>
            #editor{
                position: absolute;
                bottom: -1em;
                padding: 0px;
                width: 100%;
                height: 300px;
                outline: none;
            }
            .button{
                background-color: #155de9;
                color:bisque;
                border: none;
                padding: 10px 20px;
                text-align: center;
                font-family: 'Arial';
            }
            .default{
                line-height: normal;
                padding: 4px;
                height: 100%;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <ul id="projectList"></ul>
        
        <input type="text" id="pn" placeholder="Project Name">
        <br><br><br>
        <div id="editor">

        </div><br>
        <button onclick="a()" id="run" style="background-color: greenyellow;">Run</button>
        <button onclick="save()" style="background-color:blue;">Save</button>
        <pre id="output"></pre>
        <script>
            
                /*@param x*/
            
                document.addEventListener("keydown", (e) => {
                   if(e.ctrlKey && e.altKey && (e.key == "r" || e.key == "R")){
                        document.getElementById("run").click();
                   }
                })
            function a(){
                const code = document.getElementById("tc").value;
                
                const ifr = document.getElementById("sandbox");
                    if(!code.trim()){
                    alert("Error")
                    return;
                }
                
               
                const html = `
                <!DOCTYPE html>
                <html>
                <body>
                    <p id="a"></p>
                <script>
                    window.onerror = function(message, src, line, col, err){
                alert("Error:"+ message);
                }
                
                    try{
                    ${code}
                    }catch(e){
                    alert('Error:'+ e.message);
                    throw new Error(e.message);
                    document.getElementById("a").textContent = e.message;
                    console.log(e.message)
                }
                <\/script>
                
                </body>
                </html>
            `
           
            ifr.srcdoc = html;
            
                
            }
           function save(){
            const name = document.getElementById("pn").value.trim();
            const code = document.getElementById("tc").value;
            if(!name){
                throw new Error("Name is required");
                return;
            }
            localStorage.setItem("project_"+ name, code);
           }
           function loadProjects(){
               const list = document.getElementById("projectList");
               list.innerHTML = '';
               for(let i = 0; i < localStorage.length; i++){
                   const key = localStorage.key(i);
                   if(key.startsWith("project_")){
                       const li = document.createElement("li");
                       li.textContent = key.replace("project_", "");
                       li.onclick = () => {
                           document.getElementById("pn").value = li.textContent;
                           document.getElementById("tc").value = localStorage.getItem(key);
                       };
                       list.appendChild(li);
                   }
               }
           }
           loadProjects();
        </script>
        
        <div class="default">
            
        
            
        </div>
        <textarea id="tc" rows="20" cols="50">alert("hi");</textarea>
        
        <p id="result"></p>
        <iframe id="sandbox" sandbox="allow-scripts allow-modals"></iframe>
    </body>
</html>