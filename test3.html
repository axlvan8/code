<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Canabalt / Geometry Dash Clone</title>
  <style>
    canvas {
      border: 1px solid black;
      display: block;
      margin: 0 auto;
      background-color: #e0f7fa;
    }
  </style>
</head>
<body>
  <div style="text-align: center; margin-top: 10px;">
    <h2>Leaderboard</h2>
    <ul id="leaderboard"></ul>
  </div>

  <canvas id="canvas" width="640" height="480"></canvas>

  <script>
    window.onload = function () {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const floorHeight = 40;
      const floorY = canvas.height - floorHeight;
      let score = 0;

      const player = {
        x: 100,
        y: 0,
        width: 30,
        height: 30,
        vy: 0,
        isOnGround: false,
        C: 0
      };

      const game = {
        gravity: 1,
        jumpForce: -15,
        scrollSpeed: 4,
        floorTiles: [],
        isGameOver: false
      };

      const obstacles = [];

      function Floor(x, y, width, height) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
      }

      for (let i = 0; i < 3; i++) {
        game.floorTiles.push(new Floor(i * 300, floorY, 300, floorHeight));
      }

      player.y = floorY - player.height;

      function drawScore() {
        ctx.fillStyle = "black";
        ctx.font = "20px Arial";
        ctx.fillText("Score: " + Math.floor(score), 10, 30);
      }

      function drawPlayer() {
        ctx.fillStyle = "yellow";
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }

      function drawFloor() {
        ctx.fillStyle = "gray";
        game.floorTiles.forEach(floor => {
          ctx.fillRect(floor.x, floor.y, floor.width, floor.height);
        });
      }

      function drawObstacles() {
        ctx.fillStyle = "lime";
        obstacles.forEach(obs => {
          ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
        });
      }

      function updatePlayer() {
        player.vy += game.gravity;
        player.y += player.vy;
        player.isOnGround = false;

        game.floorTiles.forEach(floor => {
          if (
            player.y + player.height >= floor.y &&
            player.y + player.height <= floor.y + floor.height &&
            player.x + player.width > floor.x &&
            player.x < floor.x + floor.width
          ) {
            player.y = floor.y - player.height;
            player.vy = 0;
            player.isOnGround = true;
          }
        });

        if (player.y > canvas.height) {
          gameOver();
        }
      }

      function updateFloor() {
        game.floorTiles.forEach(floor => {
          floor.x -= game.scrollSpeed;
        });

        if (game.floorTiles[0].x + game.floorTiles[0].width < 0) {
          game.floorTiles.shift();
        }

        const last = game.floorTiles[game.floorTiles.length - 1];
        if (last.x + last.width < canvas.width) {
          const gap = Math.random() < 0.3 ? 60 + Math.random() * 40 : 0;
          const newX = last.x + last.width + gap;
          const newWidth = 200 + Math.random() * 150;
          game.floorTiles.push(new Floor(newX, floorY, newWidth, floorHeight));
        }
      }

      function updateObstacles() {
        obstacles.forEach(obs => {
          obs.x -= game.scrollSpeed;
        });

        
        while (obstacles.length > 0 && obstacles[0].x + obstacles[0].width < 0) {
          obstacles.shift();
        }
      }

      function spawnObstacle() {
        const height = 40 + Math.random() * 60;
        obstacles.push({
          x: canvas.width,
          y: floorY - height,
          width: 30,
          height: height
        });
      }

      function checkObstacleCollision() {
        obstacles.forEach(obs => {
          if (
            player.x < obs.x + obs.width &&
            player.x + player.width > obs.x &&
            player.y < obs.y + obs.height &&
            player.y + player.height > obs.y
          ) {
            gameOver();
          }
        });
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFloor();
        drawPlayer();
        drawObstacles();
        drawScore();
      }

      function gameLoop() {
        if (!game.isGameOver) {
          updateFloor();
          updatePlayer();
          updateObstacles();
          checkObstacleCollision();
          score += 0.1;
        }

        draw();
        requestAnimationFrame(gameLoop);
      }

      function saveScore(name, currentScore) {
        let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
        leaderboard.push({ name, score: currentScore });
        leaderboard.sort((a, b) => b.score - a.score);
        leaderboard = leaderboard.slice(0, 5);
        localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
      }

      function renderLeaderboard() {
        const leaderboardList = document.getElementById("leaderboard");
        const leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

        leaderboardList.innerHTML = leaderboard
          .map((entry, index) => `<li>#${index + 1}: ${entry.name} â€“ ${entry.score}</li>`)
          .join("");
      }

      function gameOver() {
        if (game.isGameOver) return;
        game.isGameOver = true;
        const final = Math.floor(score);
        const name = prompt("Name:") || "Anonymous";
        saveScore(name, final);
        renderLeaderboard();

        const msg = document.createElement("h3");
        msg.textContent = `Game over, ${name} scored ${final}`;
        msg.style.textAlign = "center";
        document.body.appendChild(msg);

        const button = document.createElement("button");
        button.textContent = "Play Again";
        button.style.display = "block";
        button.style.margin = "20px auto";
        button.style.fontSize = "20px";
        button.onclick = () => window.location.reload();
        document.body.appendChild(button);
      }

      // Input - only jump when on ground (Geometry Dash style)
      window.addEventListener("keydown", function (e) {
        if(player.c == 2){
            player.c = 0;
        }
        if ((e.code === "Space" || e.key === " ") && player.c < 2) {
          player.vy = game.jumpForce;
          c++;
          
        }
      });

      window.addEventListener("click", function () {
        if (player.isOnGround) {
          player.vy = game.jumpForce;
        }
      });

      // Start spawning obstacles every 2 seconds
      setInterval(() => {
        if (!game.isGameOver) spawnObstacle();
      }, 2000);

      renderLeaderboard();
      gameLoop();
    };
  </script>
</body>
</html>
